# Smart-Codebase

[English](README.md) | [ç®€ä½“ä¸­æ–‡](README.zh-cn.md)

> **è®©ä½ çš„ OpenCode åœ¨å®Œæˆä»»åŠ¡æ—¶ï¼Œä¸æ–­å­¦ä¹ æˆé•¿ï¼Œå˜æˆä½ ç‹¬ä¸€æ— äºŒçš„èµ„æ·±é¡¹ç›®ä¸“å®¶ã€‚**

---

## ğŸ”¥ ä½ çš„ç—›ç‚¹

æ¯æ¬¡å¼€å§‹æ–°ä¼šè¯æ—¶ï¼ŒAI éƒ½ä»é›¶å¼€å§‹ã€‚å®ƒä¸è®°å¾—ï¼š
- ä½ ä¸ºä»€ä¹ˆé€‰æ‹©é‚£ä¸ªæ¶æ„ï¼Ÿ
- ä»£ç åº“ä¸­å­˜åœ¨å“ªäº›å‘ï¼Ÿ
- ä½ çš„å›¢é˜Ÿéµå¾ªä»€ä¹ˆæ¨¡å¼ï¼Ÿ
- ä½ ä»è°ƒè¯•é‚£ä¸ªæ£˜æ‰‹çš„ bug ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ

**ä½ ä¸€éåˆä¸€éåœ°è§£é‡ŠåŒæ ·çš„äº‹æƒ…ã€‚**

## âœ¨ è§£å†³æ–¹æ¡ˆ

smart-codebase è‡ªåŠ¨ä»ä¼šè¯ä¸­æ•è·çŸ¥è¯†ï¼Œå¹¶ä½¿å…¶å¯ä¾›æœªæ¥ä¼šè¯ä½¿ç”¨ã€‚

```mermaid
graph TB
    Start([ä¼šè¯å·¥ä½œ])
    Extractor[AI æå–å™¨åˆ†æ]
    SkillFile[.knowledge/SKILL.md<br/>æ¨¡å—çŸ¥è¯†]
    ProjectSkill[.opencode/skills/project/SKILL.md<br/>OpenCode è‡ªåŠ¨å‘ç°]
    NewSession([æ–°ä¼šè¯å¼€å§‹])
    Injector[çŸ¥è¯†æ³¨å…¥å™¨]
    
    Start -->|ç©ºé—²| Extractor
    Extractor -->|å†™å…¥| SkillFile
    Extractor -->|æ›´æ–°ç´¢å¼•| ProjectSkill
    
    NewSession --> Injector
    Injector -->|æ³¨å…¥æç¤º| ProjectSkill
    ProjectSkill -.->|å¼•ç”¨| SkillFile
```

---

## ğŸ“– ç›®å½•

- [âš™ï¸ å·¥ä½œåŸç†](#ï¸-å·¥ä½œåŸç†)
- [ğŸ“¦ å®‰è£…](#-å®‰è£…)
- [âš¡ å‘½ä»¤](#-å‘½ä»¤)
- [âš™ï¸ é…ç½®](#ï¸-é…ç½®)
- [ğŸ“ æ–‡ä»¶ç»“æ„](#-æ–‡ä»¶ç»“æ„)
- [ğŸ“Š ä½¿ç”¨ç»Ÿè®¡](#-ä½¿ç”¨ç»Ÿè®¡)
- [ğŸ§¹ æ¸…ç†å‘½ä»¤](#-æ¸…ç†å‘½ä»¤)
- [ğŸ› ï¸ å¼€å‘](#ï¸-å¼€å‘)

---

## âš™ï¸ å·¥ä½œåŸç†

1. **ä½ æ­£å¸¸å·¥ä½œ** - ç¼–è¾‘æ–‡ä»¶ã€è°ƒè¯•é—®é¢˜ã€åšå†³ç­–
2. **ä¼šè¯ç©ºé—²** - 60 ç§’æ— æ´»åŠ¨åï¼Œå‡ºç° toast é€šçŸ¥
3. **ä½ å¯ä»¥æ‰“æ–­** - å‘é€æ¶ˆæ¯å³å¯å–æ¶ˆæå–å¹¶ç»§ç»­å·¥ä½œ
4. **æå–å™¨åˆ†æ** - AI æ£€æŸ¥å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ä»¥åŠä¸ºä»€ä¹ˆï¼ˆå¸¦è¿›åº¦é€šçŸ¥ï¼‰
5. **çŸ¥è¯†è¢«æ•è·** - å­˜å‚¨åœ¨ `.opencode/skills/<é¡¹ç›®>/modules/<æ¨¡å—>.md` ä¸­
6. **ç´¢å¼•æ›´æ–°** - å…¨å±€ç´¢å¼•ä½äº `.opencode/skills/<é¡¹ç›®>/SKILL.md`
7. **ä¸‹æ¬¡ä¼šè¯å¼€å§‹** - AI è¯»å–é¡¹ç›® skillï¼Œç„¶åå‘ç°ç›¸å…³æ¨¡å— skill

**æ’ä»¶åœ¨åå°é™é»˜å·¥ä½œã€‚Toast é€šçŸ¥è®©ä½ çŸ¥æƒ…ï¼Œè€Œä¸æ‰“æ–­ä½ çš„å·¥ä½œæµã€‚**

---

## ğŸ“¦ å®‰è£…

è¿›å…¥ `~/.config/opencode` ç›®å½•ï¼š

```bash
# ä½¿ç”¨ bun
bun add smart-codebase

# æˆ–ä½¿ç”¨ npm
npm install smart-codebase
```

æ·»åŠ åˆ°ä½ çš„ `opencode.json`ï¼š

```json
{
  "plugin": ["smart-codebase"]
}
```

---

## âš¡ å‘½ä»¤

| å‘½ä»¤ | æè¿° |
|------|------|
| `/sc-status` | æ˜¾ç¤ºçŸ¥è¯†åº“çŠ¶æ€å’Œä½¿ç”¨ç»Ÿè®¡ |
| `/sc-extract` | æ‰‹åŠ¨è§¦å‘çŸ¥è¯†æ²‰æ·€ |
| `/sc-rebuild-index` | ä»æ‰€æœ‰ SKILL.md æ–‡ä»¶é‡å»º `.knowledge/KNOWLEDGE.md` |
| `/sc-cleanup` | æ¸…ç†ä½ä½¿ç”¨ç‡ SKILL æ–‡ä»¶ï¼ˆé¢„è§ˆæ¨¡å¼ï¼‰ |
| `/sc-cleanup --confirm` | å®é™…åˆ é™¤ä½ä½¿ç”¨ç‡ SKILL æ–‡ä»¶ |

---

## âš™ï¸ é…ç½®

é»˜è®¤æ— é¡»é…ç½®ï¼Œå¦‚éœ€æ”¹å˜é»˜è®¤é…ç½®ï¼Œåˆ›å»º `~/.config/opencode/smart-codebase.json`ï¼ˆæˆ– `.jsonc`ï¼‰ï¼š

```jsonc
{
  "enabled": true,
  "debounceMs": 30000,
  "autoExtract": true,
  "autoInject": true,
  "extractionModel": "minimax/MiniMax-M2.1",
  "disabledCommands": ["sc-rebuild-index"]
}
```

| é€‰é¡¹ | é»˜è®¤å€¼ | æè¿° |
|------|--------|------|
| `enabled` | `true` | å®Œå…¨å¯ç”¨/ç¦ç”¨æ’ä»¶ |
| `debounceMs` | `60000` | ä¼šè¯ç©ºé—²åç­‰å¾…å¤šä¹…ï¼ˆæ¯«ç§’ï¼‰æ‰æå– |
| `autoExtract` | `true` | ç©ºé—²æ—¶è‡ªåŠ¨æå–çŸ¥è¯† |
| `autoInject` | `true` | ä¼šè¯å¼€å§‹æ—¶æ³¨å…¥çŸ¥è¯†æç¤º |
| `extractionModel` | - | çŸ¥è¯†æå–ä½¿ç”¨çš„æ¨¡å‹ï¼Œæ ¼å¼ï¼š`providerID/modelID` |
| `extractionMaxTokens` | `8000` | æå–ä¸Šä¸‹æ–‡çš„æœ€å¤§ token é¢„ç®— |
| `disabledCommands` | `[]` | è¦ç¦ç”¨çš„å‘½ä»¤ï¼Œå¦‚ `["sc-rebuild-index"]` |
| `cleanupThresholds` | è§ä¸‹æ–¹ | æ¸…ç†å‘½ä»¤çš„é˜ˆå€¼ |

#### cleanupThresholds

| é€‰é¡¹ | é»˜è®¤å€¼ | æè¿° |
|------|--------|------|
| `cleanupThresholds.minAgeDays` | `60` | æ¸…ç†åˆæ ¼çš„æœ€å°å¹´é¾„ï¼ˆå¤©ï¼‰ |
| `cleanupThresholds.minAccessCount` | `5` | æ¸…ç†åˆæ ¼çš„æœ€å¤§è®¿é—®æ¬¡æ•° |
| `cleanupThresholds.maxInactiveDays` | `60` | æ¸…ç†åˆæ ¼çš„æœ€å¤§æœªè®¿é—®å¤©æ•° |

---

## ğŸ“ æ–‡ä»¶ç»“æ„ç¤ºä¾‹

```
project/
â”œâ”€â”€ .opencode/
â”‚   â””â”€â”€ skills/
â”‚       â””â”€â”€ <é¡¹ç›®å>/
â”‚           â”œâ”€â”€ SKILL.md          # é¡¹ç›® skillï¼ˆä¸»ç´¢å¼•ï¼‰
â”‚           â””â”€â”€ modules/
â”‚               â”œâ”€â”€ src-auth.md   # è®¤è¯æ¨¡å—çŸ¥è¯†
â”‚               â””â”€â”€ src-api.md    # API æ¨¡å—çŸ¥è¯†
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ session.ts
â”‚   â”‚   â””â”€â”€ jwt.ts
â”‚   â”‚
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ routes.ts
```

`.opencode/skills/<é¡¹ç›®>/SKILL.md` ä½œä¸ºå…¨å±€ç´¢å¼•ï¼Œä¼šè¢« OpenCode è‡ªåŠ¨å‘ç°ã€‚æ¨¡å—çº§åˆ«çš„çŸ¥è¯†å­˜å‚¨åœ¨ `.opencode/skills/<é¡¹ç›®>/modules/<æ¨¡å—å>.md` ä¸­ã€‚

---

### ğŸ“Š ä½¿ç”¨ç»Ÿè®¡

`/sc-status` å‘½ä»¤ç°åœ¨æ˜¾ç¤ºï¼š
- æ€» SKILL æ•°é‡
- æ‰€æœ‰ SKILL çš„æ€»è®¿é—®æ¬¡æ•°
- ä½é¢‘ SKILL æ•°é‡ï¼ˆåŸºäº cleanupThresholdsï¼‰
- ä½¿ç”¨æƒ…å†µåˆ†è§£ï¼ˆé«˜/ä¸­/ä½ï¼‰

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š ä½¿ç”¨ç»Ÿè®¡ï¼š
æ€» SKILL æ•°ï¼š15
æ€»è®¿é—®æ¬¡æ•°ï¼š234
ä½é¢‘ SKILLï¼ˆ< 5 æ¬¡è®¿é—®ï¼‰ï¼š3

ä½¿ç”¨æƒ…å†µåˆ†è§£ï¼š
  - é«˜é¢‘ä½¿ç”¨ï¼ˆâ‰¥10 æ¬¡è®¿é—®ï¼‰ï¼š8 ä¸ª SKILL
  - ä¸­é¢‘ä½¿ç”¨ï¼ˆ5-10 æ¬¡ï¼‰ï¼š4 ä¸ª SKILL
  - ä½é¢‘ä½¿ç”¨ï¼ˆ<5 æ¬¡ï¼‰ï¼š3 ä¸ª SKILL
```

---

### ğŸ§¹ æ¸…ç†å‘½ä»¤

æ ¹æ®å¯é…ç½®çš„é˜ˆå€¼åˆ é™¤ä½ä½¿ç”¨ç‡çš„ SKILL æ–‡ä»¶ã€‚

**é¢„è§ˆæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰**ï¼š
```bash
/sc-cleanup
```

åˆ—å‡ºåˆæ ¼çš„ SKILL è€Œä¸åˆ é™¤å®ƒä»¬ã€‚

**ç¡®è®¤æ¨¡å¼**ï¼š
```bash
/sc-cleanup --confirm
```

å®é™…åˆ é™¤æ–‡ä»¶å¹¶æ›´æ–°ä¸»ç´¢å¼•ã€‚

**æ¸…ç†æ¡ä»¶ï¼ˆAND é€»è¾‘ï¼‰**ï¼š
å½“æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶æ—¶ï¼ŒSKILL å³ç¬¦åˆæ¸…ç†æ¡ä»¶ï¼š
1. å¹´é¾„ â‰¥ `minAgeDays`ï¼ˆé»˜è®¤ï¼š60 å¤©ï¼‰
2. è®¿é—®æ¬¡æ•° < `minAccessCount`ï¼ˆé»˜è®¤ï¼š5ï¼‰
3. è·ç¦»æœ€åè®¿é—® â‰¥ `maxInactiveDays`ï¼ˆé»˜è®¤ï¼š60 å¤©ï¼‰

---

## ğŸ› ï¸ å¼€å‘

```bash
# å®‰è£…ä¾èµ–
bun install

# æ„å»º
bun run build

# ç±»å‹æ£€æŸ¥
bun run typecheck
```

---

## ğŸ“„ è®¸å¯è¯

[Apache-2.0](LICENSE)
